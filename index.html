<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Blockly</title>
    <script src="blockly.min.js"></script>
    <script src="python_compressed.js"></script>
    <script src="custom_blocks.js"></script>
    <script src="custom_code_generator.js"></script>
    <script src="web_client.js"></script>
    <style>
        body {
            background-color: #fff;
            font-family: sans-serif;
        }
        h1 {
            font-weight: normal;
            font-size: 140%;
        }
    </style>
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="complexity_scaling.css">
</head>
<body>
<h1 style="font-family: 'Noto Sans', 'Noto Sans JP', 'Noto Sans KR', 'Noto Naskh Arabic', 'Noto Sans Thai', 'Noto Sans Hebrew', 'Noto Sans Bengali', sans-serif; font-size: 40px; margin-left: 10px;">Blockly</h1>
<div id="language_selection">
    <img class="lang_img" src="images/flags/en.png" alt="English" onclick="changeLanguage('en')" style="cursor: pointer; width: 60px; height: 40px; margin-left: 10px;">
    <img class="lang_img" src="images/flags/nl.png" alt="Nederlands" onclick="changeLanguage('nl')" style="cursor: pointer; width: 60px; height: 40px; margin-left: 10px;">
    <img class="lang_img" src="images/flags/fr.png" alt="FranÃ§ais" onclick="changeLanguage('fr')" style="cursor: pointer; width: 60px; height: 40px; margin-left: 10px;">
    <img class="lang_img" src="images/flags/de.png" alt="Deutsch" onclick="changeLanguage('de')" style="cursor: pointer; width: 60px; height: 40px; margin-left: 10px;">
</div>
<div id="language">

</div>
<script>
    function changeLanguage(value) {
        if (Blockly.getMainWorkspace().getAllBlocks().length > 0) {
            var answer = confirm("Changing the renderer will clear your workspace. " +
                "Are you sure you want to continue?");
            if (!answer) {
                var langSelector = document.getElementById('langselector');
                langSelector.value = document.getElementById('block_lang').src.split('/').pop().split('.')[0];
                return;
            }
        }
        var params = new URLSearchParams(window.location.search);
        params.set('lang', value);
        window.location.search = params.toString();
    }
</script>

<div style="display:flex">

    <div id="blocklyDiv" style="height: 600px; width: 60%; min-width: 900px; border: 2px solid #7F7FFF; margin-left: 10px; "></div>

    <xml id="toolbox" style="display: none">
        <category id="catLogic" colour="210" name="%{BKY_LOGIC_TITLE}">
            <block type="controls_if"></block>
            <block type="logic_compare"></block>
            <block type="logic_operation"></block>
            <block type="logic_negate"></block>
            <block type="logic_boolean"></block>
            <block type="logic_null"></block>
            <block type="logic_ternary"></block>
        </category>
        <category id="catLoops" colour="120" name="%{BKY_LOOPS_TITLE}">
            <block type="controls_repeat_ext">
                <value name="TIMES">
                    <shadow type="math_number">
                        <field name="NUM">10</field>
                    </shadow>
                </value>
            </block>
            <block type="controls_whileUntil"></block>
            <block type="controls_for">
                <value name="FROM">
                    <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow>
                </value>
                <value name="TO">
                    <shadow type="math_number">
                        <field name="NUM">10</field>
                    </shadow>
                </value>
                <value name="BY">
                    <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow>
                </value>
            </block>
            <block type="controls_forEach"></block>
            <block type="controls_flow_statements"></block>
        </category>
        <category id="catMath" colour="230" name="%{BKY_MATH_TITLE}">
            <block type="math_number"></block>
            <block type="math_arithmetic">
                <value name="A">
                    <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow>
                </value>
                <value name="B">
                    <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow>
                </value>
            </block>
            <block type="math_single">
                <value name="NUM">
                    <shadow type="math_number">
                        <field name="NUM">9</field>
                    </shadow>
                </value>
            </block>
            <block type="math_trig">
                <value name="NUM">
                    <shadow type="math_number">
                        <field name="NUM">45</field>
                    </shadow>
                </value>
            </block>
            <block type="math_constant"></block>
            <block type="math_number_property">
                <value name="NUMBER_TO_CHECK">
                    <shadow type="math_number">
                        <field name="NUM">0</field>
                    </shadow>
                </value>
            </block>
            <block type="math_change">
                <value name="DELTA">
                    <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow>
                </value>
            </block>
            <block type="math_round">
                <value name="NUM">
                    <shadow type="math_number">
                        <field name="NUM">3.1</field>
                    </shadow>
                </value>
            </block>
            <block type="math_on_list"></block>
            <block type="math_modulo">
                <value name="DIVIDEND">
                    <shadow type="math_number">
                        <field name="NUM">64</field>
                    </shadow>
                </value>
                <value name="DIVISOR">
                    <shadow type="math_number">
                        <field name="NUM">10</field>
                    </shadow>
                </value>
            </block>
            <block type="math_constrain">
                <value name="VALUE">
                    <shadow type="math_number">
                        <field name="NUM">50</field>
                    </shadow>
                </value>
                <value name="LOW">
                    <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow>
                </value>
                <value name="HIGH">
                    <shadow type="math_number">
                        <field name="NUM">100</field>
                    </shadow>
                </value>
            </block>
            <block type="math_random_int">
                <value name="FROM">
                    <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow>
                </value>
                <value name="TO">
                    <shadow type="math_number">
                        <field name="NUM">100</field>
                    </shadow>
                </value>
            </block>
            <block type="math_random_float"></block>
        </category>
        <category id="catText" colour="160" name="%{BKY_TEXT_TITLE}">
            <block type="text"></block>
            <block type="text_join"></block>
            <block type="text_append">
                <value name="TEXT">
                    <shadow type="text"></shadow>
                </value>
            </block>
            <block type="text_length">
                <value name="VALUE">
                    <shadow type="text">
                        <field name="TEXT">abc</field>
                    </shadow>
                </value>
            </block>
            <block type="text_isEmpty">
                <value name="VALUE">
                    <shadow type="text">
                        <field name="TEXT"></field>
                    </shadow>
                </value>
            </block>
            <block type="text_indexOf">
                <value name="VALUE">
                    <block type="variables_get">
                        <field name="VAR">text</field>
                    </block>
                </value>
                <value name="FIND">
                    <shadow type="text">
                        <field name="TEXT">abc</field>
                    </shadow>
                </value>
            </block>
            <block type="text_charAt">
                <value name="VALUE">
                    <block type="variables_get">
                        <field name="VAR">text</field>
                    </block>
                </value>
            </block>
            <block type="text_getSubstring">
                <value name="STRING">
                    <block type="variables_get">
                        <field name="VAR">text</field>
                    </block>
                </value>
            </block>
            <block type="text_changeCase">
                <value name="TEXT">
                    <shadow type="text">
                        <field name="TEXT">abc</field>
                    </shadow>
                </value>
            </block>
            <block type="text_trim">
                <value name="TEXT">
                    <shadow type="text">
                        <field name="TEXT">abc</field>
                    </shadow>
                </value>
            </block>
            <block type="text_print">
                <value name="TEXT">
                    <shadow type="text">
                        <field name="TEXT">abc</field>
                    </shadow>
                </value>
            </block>
            <block type="text_prompt_ext">
                <value name="TEXT">
                    <shadow type="text">
                        <field name="TEXT">abc</field>
                    </shadow>
                </value>
            </block>
        </category>
        <category id="catLists" colour="260" name="%{BKY_LISTS_TITLE}">
            <block type="lists_create_with">
                <mutation items="0"></mutation>
            </block>
            <block type="lists_create_with"></block>
            <block type="lists_repeat">
                <value name="NUM">
                    <shadow type="math_number">
                        <field name="NUM">5</field>
                    </shadow>
                </value>
            </block>
            <block type="lists_length"></block>
            <block type="lists_isEmpty"></block>
            <block type="lists_indexOf">
                <value name="VALUE">
                    <block type="variables_get">
                        <field name="VAR">list</field>
                    </block>
                </value>
            </block>
            <block type="lists_getIndex">
                <value name="VALUE">
                    <block type="variables_get">
                        <field name="VAR">list</field>
                    </block>
                </value>
            </block>
            <block type="lists_setIndex">
                <value name="LIST">
                    <block type="variables_get">
                        <field name="VAR">list</field>
                    </block>
                </value>
            </block>
            <block type="lists_getSublist">
                <value name="LIST">
                    <block type="variables_get">
                        <field name="VAR">list</field>
                    </block>
                </value>
            </block>
            <block type="lists_split">
                <value name="DELIM">
                    <shadow type="text">
                        <field name="TEXT">,</field>
                    </shadow>
                </value>
            </block>
            <block type="lists_sort"></block>
        </category>
        <category id="catColour" colour="20" name="%{BKY_COLOR_TITLE}">
            <block type="colour_picker"></block>
            <block type="colour_random"></block>
            <block type="colour_rgb">
                <value name="RED">
                    <shadow type="math_number">
                        <field name="NUM">100</field>
                    </shadow>
                </value>
                <value name="GREEN">
                    <shadow type="math_number">
                        <field name="NUM">50</field>
                    </shadow>
                </value>
                <value name="BLUE">
                    <shadow type="math_number">
                        <field name="NUM">0</field>
                    </shadow>
                </value>
            </block>
            <block type="colour_blend">
                <value name="COLOUR1">
                    <shadow type="colour_picker">
                        <field name="COLOUR">#ff0000</field>
                    </shadow>
                </value>
                <value name="COLOUR2">
                    <shadow type="colour_picker">
                        <field name="COLOUR">#3333ff</field>
                    </shadow>
                </value>
                <value name="RATIO">
                    <shadow type="math_number">
                        <field name="NUM">0.5</field>
                    </shadow>
                </value>
            </block>
        </category>
        <sep></sep>
        <category id="catVariables" colour="330" custom="VARIABLE" name="%{BKY_VARIABLES_TITLE}"></category>
        <category id="catFunctions" colour="290" custom="PROCEDURE" name="%{BKY_FUNCTIONS_TITLE}"></category>
        <sep></sep>
        <category colour="190" name="%{BKY_INSECT_FARM_FUNCTIONS_TITLE}">
            <block type="Grab">
            </block>
            <block type="Drop">
            </block>
            </block>
            <block type="Feed">
            </block>
            <block type="MoveTo">
            </block>
            <block type="MoveToItem">
            </block>
            <block type="Put">
            </block>
            <block type="Take">
            </block>
        </category>
        <category colour="130" name="%{BKY_INSECT_FARM_COMPLEX_FUNCTIONS_TITLE}">
            <block type="MoveItemTo">
            </block>
            <block type="MoveItemToItem">
            </block>
<!--            <block type="ChangePopulationOfBox">-->
<!--            </block>-->
            <block type="ChangeBoxOfItem">
            </block>
            <block type="OnGesture">
            </block>
        </category>

        <category colour="70" name="%{BKY_INSECT_FARM_ELEMENTS_TITLE}">
            <block type="Box">
            </block>
            <block type="Egg">
            </block>
            <block type="AGV">
            </block>
            <block type="Adult">
            </block>
            <block type="Compartment">
            </block>
        </category>
    </xml>
    <script>
        window.onload = function () {
            var langTag = document.getElementById("language");
            var searchParams = new URLSearchParams(window.location.search);
            var lang = searchParams.get('lang');
            if (!lang) {
                lang = "en";
            }
            else {
                var intro = document.getElementById("language_selection_intro");
                intro.style.display = "none";
            }
            var langScript = document.createElement("script");
            langScript.id = "block_lang";
            langScript.src = lang + ".js";
            langTag.appendChild(langScript);

            setTimeout(function () {
                Blockly.Theme.defineTheme('custom', {
                    'base': Blockly.Themes.Classic,
                    'startHats': true
                });
                var demoWorkspace = Blockly.inject('blocklyDiv',
                    {renderer: 'zelos',
                        language: 'python',
                        theme: 'custom',
                        toolbox: document.getElementById('toolbox')});
                demoWorkspace.addChangeListener(function(event) {
                    if (event.type == Blockly.Events.VIEWPORT_CHANGE) {
                        return;
                    }
                    workspaceToCodeDebug(demoWorkspace);
                });
                initCategories();
                var blocklyMainWorkspace = document.getElementsByClassName("blocklyMainBackground")[0];
                blocklyMainWorkspace.style.fill = "#DDDDFF";
                var blocklyMainWorkspace = document.getElementsByClassName("blocklyToolboxDiv")[0];
                blocklyMainWorkspace.style.background = "#BBBBFF";
            }, 250);
        };
    </script>

    <div id="debug" style="display: flex">
        <p id="breakpoints", style="width: 12px; height: 550px; overflow-y: hidden" onscroll="scrollBreakpoints()"></p>
        <p id="debugText1", style="width: 600px; height: 550px; overflow-y: auto" onscroll="scrollDebugText()"></p>
    </div>
</div>
<img src="images/um.png" alt="UM" width="350px" height="50px"; style="margin-left: 10px; margin-right: 50px; margin-top: 10px;">
<img src="images/cs.svg" alt="CoRoSect" width="80px" height="50px">
<br>

<bottom>
<bottombox>
<label for="renderer">Renderer:</label>
<select class="rendererselect" name="renderer" id="renderer" onchange="changeRenderer()">
    <option class="opt" value="zelos">zelos</option>
    <option class="opt" value="geras">geras</option>
    <option class="opt" value="thrasos">thrasos</option>
</select>
</bottombox>
<script>
    function changeRenderer() {
        var demoWorkspace = Blockly.getMainWorkspace();
        if (demoWorkspace.getAllBlocks().length > 0) {
            var answer = confirm("Changing the renderer will clear your workspace. " +
                "Are you sure you want to continue?");
            if (!answer) {
                document.getElementById('renderer').value = demoWorkspace.getRenderer().name;
                return;
            }
        }
        var renderer = document.getElementById('renderer').value;
        demoWorkspace.dispose();
        demoWorkspace = Blockly.inject('blocklyDiv',
            {renderer: renderer,
                language: 'python',
                theme: 'custom',
                toolbox: document.getElementById('toolbox')});
        demoWorkspace.addChangeListener(function(event) {
            if (event.type == Blockly.Events.VIEWPORT_CHANGE) {
                return;
            }
            workspaceToCodeDebug(demoWorkspace);
        });
        //initCategories();
        var blocklyMainWorkspace = document.getElementsByClassName("blocklyMainBackground")[0];
        blocklyMainWorkspace.style.fill = "#DDDDFF";
        var blocklyMainWorkspace = document.getElementsByClassName("blocklyToolboxDiv")[0];
        blocklyMainWorkspace.style.background = "#BBBBFF";
    }
</script>
<!-- Buttons to change skill level after the intro screen -->
<bottombox>
<span class="margin_left">Complexity Level:</span>
<button onclick="setComplexityLevel(SKILL_LEVELS.BEGINNER)">Beginner</button>
<button onclick="setComplexityLevel(SKILL_LEVELS.INTERMEDIATE)">Intermediate</button>
<button onclick="setComplexityLevel(SKILL_LEVELS.EXPERT)">Expert</button>
</bottombox>
<bottombox>
<label for="token" style="vertical-align: middle">Token:</label>
<textarea id="token" rows="1" cols="50" style="font-size: small; vertical-align: middle"></textarea>
</bottombox>
<bottombox>
<label for="local">Local:</label>
<input type="checkbox" id="local" name="local" value="local">
</bottombox>
<bottombox>
<button id="send_code_request" onclick="sendRequest()">Send Code</button>
</bottombox>
<bottombox>
<div id="output">
    Output:
    <p class="outputText" id="outputText">
        No output yet.
    </p>
</div>
</bottombox>
</bottom>
<canvas id="full_screen_canvas" style="width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: 999999; pointer-events: none;"></canvas>

<div id="language_selection_intro">
    <p>Choose Language</p>
    <img src="images/flags/en.png" onclick="changeLanguage('en')" style="width: 300px; height: 200px; margin: 10px; cursor: pointer">
    <img src="images/flags/nl.png" onclick="changeLanguage('nl')" style="width: 300px; height: 200px; margin: 10px; cursor: pointer">
    <img src="images/flags/fr.png" onclick="changeLanguage('fr')" style="width: 300px; height: 200px; margin: 10px; cursor: pointer">
    <img src="images/flags/de.png" onclick="changeLanguage('de')" style="width: 300px; height: 200px; margin: 10px; cursor: pointer">
</div>

<!-- Intro screen where the user can select their skill level -->
<div id="skill_level_selection_back">
</div>
<div id="skill_level_selection">
    <p>How familiar are you with programming?</p>
    <div class="answer" onclick="setComplexityLevel(SKILL_LEVELS.BEGINNER, true)">
        I am a beginner
        <div class="tip">Only the basics.</div>
    </div>
    <div class="answer" onclick="setComplexityLevel(SKILL_LEVELS.INTERMEDIATE, true)">
        I am a little familiar
        <div class="tip">You will have access to math, text, and lists.</div>
    </div>
    <div class="answer" onclick="setComplexityLevel(SKILL_LEVELS.EXPERT, true)">
        I am an expert
        <div class="tip">You will have access to variables and functions.</div>
    </div>
</div>

<script src="complexity_scaling.js"></script>

</body>
</html>