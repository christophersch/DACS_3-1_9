<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Blockly</title>
    <script src="blockly.min.js"></script>
    <script src="python_compressed.js"></script>
    <script src="custom_blocks.js"></script>
    <script src="custom_code_generator.js"></script>
    <script src="web_client.js"></script>
    <style>
        body {
            background-color: #fff;
            font-family: sans-serif;
        }
        h1 {
            font-weight: normal;
            font-size: 140%;
        }

        @keyframes fade_in {
            0% {opacity: 0%}
            100% {opacity: 100%}
        }

        #skill_level_selection_back {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: #fff;
            opacity: 50%;
            z-index: 100;
        }

        #skill_level_selection {
            position: absolute;
            top:0;
            bottom: 0;
            left: 0;
            right: 0;
            
            margin: auto;
            padding: 5px;
            text-align: center;
            
            width: 500px;
            height: 250px;

            font-size:larger;

            background-color: rgb(199, 199, 199);
            opacity: 100%;

            z-index: 200;
        }

        .answer {
            padding: 10px;
            margin: 20px;
            background-color: rgb(219, 219, 219);
        }

        .answer:hover {
            filter: contrast(150%);
            user-select: none;
            cursor: pointer;
        }

        .tip {
            position: absolute;
            top: 0;
            width: 200px;
            left: 110%;
            visibility: hidden;
        }

        .answer:hover .tip {
            visibility: visible;
            animation: fade_in 0.5s forwards;
        }
    </style>
</head>
<body>
<h1>Blockly</h1>

<div style="display:flex">

    <div id="blocklyDiv" style="height: 600px; width: 1100px;"></div>

    <xml id="toolbox" style="display: none">
        <category id="catLogic" colour="210" name="Logic">
            <block type="controls_if"></block>
            <block type="logic_compare"></block>
            <block type="logic_operation"></block>
            <block type="logic_negate"></block>
            <block type="logic_boolean"></block>
            <block type="logic_null"></block>
            <block type="logic_ternary"></block>
        </category>
        <category id="catLoops" colour="120" name="Loops">
            <block type="controls_repeat_ext">
                <value name="TIMES">
                    <shadow type="math_number">
                        <field name="NUM">10</field>
                    </shadow>
                </value>
            </block>
            <block type="controls_whileUntil"></block>
            <block type="controls_for">
                <value name="FROM">
                    <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow>
                </value>
                <value name="TO">
                    <shadow type="math_number">
                        <field name="NUM">10</field>
                    </shadow>
                </value>
                <value name="BY">
                    <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow>
                </value>
            </block>
            <block type="controls_forEach"></block>
            <block type="controls_flow_statements"></block>
        </category>
        <category id="catMath" colour="230" name="Math" style="visibility:'hidden'">
            <block type="math_number"></block>
            <block type="math_arithmetic">
                <value name="A">
                    <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow>
                </value>
                <value name="B">
                    <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow>
                </value>
            </block>
            <block type="math_single">
                <value name="NUM">
                    <shadow type="math_number">
                        <field name="NUM">9</field>
                    </shadow>
                </value>
            </block>
            <block type="math_trig">
                <value name="NUM">
                    <shadow type="math_number">
                        <field name="NUM">45</field>
                    </shadow>
                </value>
            </block>
            <block type="math_constant"></block>
            <block type="math_number_property">
                <value name="NUMBER_TO_CHECK">
                    <shadow type="math_number">
                        <field name="NUM">0</field>
                    </shadow>
                </value>
            </block>
            <block type="math_change">
                <value name="DELTA">
                    <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow>
                </value>
            </block>
            <block type="math_round">
                <value name="NUM">
                    <shadow type="math_number">
                        <field name="NUM">3.1</field>
                    </shadow>
                </value>
            </block>
            <block type="math_on_list"></block>
            <block type="math_modulo">
                <value name="DIVIDEND">
                    <shadow type="math_number">
                        <field name="NUM">64</field>
                    </shadow>
                </value>
                <value name="DIVISOR">
                    <shadow type="math_number">
                        <field name="NUM">10</field>
                    </shadow>
                </value>
            </block>
            <block type="math_constrain">
                <value name="VALUE">
                    <shadow type="math_number">
                        <field name="NUM">50</field>
                    </shadow>
                </value>
                <value name="LOW">
                    <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow>
                </value>
                <value name="HIGH">
                    <shadow type="math_number">
                        <field name="NUM">100</field>
                    </shadow>
                </value>
            </block>
            <block type="math_random_int">
                <value name="FROM">
                    <shadow type="math_number">
                        <field name="NUM">1</field>
                    </shadow>
                </value>
                <value name="TO">
                    <shadow type="math_number">
                        <field name="NUM">100</field>
                    </shadow>
                </value>
            </block>
            <block type="math_random_float"></block>
        </category>
        <category id="catText" colour="160" name="Text">
            <block type="text"></block>
            <block type="text_join"></block>
            <block type="text_append">
                <value name="TEXT">
                    <shadow type="text"></shadow>
                </value>
            </block>
            <block type="text_length">
                <value name="VALUE">
                    <shadow type="text">
                        <field name="TEXT">abc</field>
                    </shadow>
                </value>
            </block>
            <block type="text_isEmpty">
                <value name="VALUE">
                    <shadow type="text">
                        <field name="TEXT"></field>
                    </shadow>
                </value>
            </block>
            <block type="text_indexOf">
                <value name="VALUE">
                    <block type="variables_get">
                        <field name="VAR">text</field>
                    </block>
                </value>
                <value name="FIND">
                    <shadow type="text">
                        <field name="TEXT">abc</field>
                    </shadow>
                </value>
            </block>
            <block type="text_charAt">
                <value name="VALUE">
                    <block type="variables_get">
                        <field name="VAR">text</field>
                    </block>
                </value>
            </block>
            <block type="text_getSubstring">
                <value name="STRING">
                    <block type="variables_get">
                        <field name="VAR">text</field>
                    </block>
                </value>
            </block>
            <block type="text_changeCase">
                <value name="TEXT">
                    <shadow type="text">
                        <field name="TEXT">abc</field>
                    </shadow>
                </value>
            </block>
            <block type="text_trim">
                <value name="TEXT">
                    <shadow type="text">
                        <field name="TEXT">abc</field>
                    </shadow>
                </value>
            </block>
            <block type="text_print">
                <value name="TEXT">
                    <shadow type="text">
                        <field name="TEXT">abc</field>
                    </shadow>
                </value>
            </block>
            <block type="text_prompt_ext">
                <value name="TEXT">
                    <shadow type="text">
                        <field name="TEXT">abc</field>
                    </shadow>
                </value>
            </block>
        </category>
        <category id="catLists" colour="260" name="Lists">
            <block type="lists_create_with">
                <mutation items="0"></mutation>
            </block>
            <block type="lists_create_with"></block>
            <block type="lists_repeat">
                <value name="NUM">
                    <shadow type="math_number">
                        <field name="NUM">5</field>
                    </shadow>
                </value>
            </block>
            <block type="lists_length"></block>
            <block type="lists_isEmpty"></block>
            <block type="lists_indexOf">
                <value name="VALUE">
                    <block type="variables_get">
                        <field name="VAR">list</field>
                    </block>
                </value>
            </block>
            <block type="lists_getIndex">
                <value name="VALUE">
                    <block type="variables_get">
                        <field name="VAR">list</field>
                    </block>
                </value>
            </block>
            <block type="lists_setIndex">
                <value name="LIST">
                    <block type="variables_get">
                        <field name="VAR">list</field>
                    </block>
                </value>
            </block>
            <block type="lists_getSublist">
                <value name="LIST">
                    <block type="variables_get">
                        <field name="VAR">list</field>
                    </block>
                </value>
            </block>
            <block type="lists_split">
                <value name="DELIM">
                    <shadow type="text">
                        <field name="TEXT">,</field>
                    </shadow>
                </value>
            </block>
            <block type="lists_sort"></block>
        </category>
        <!-- <category id="catColour" colour="20" name="Color">
            <block type="colour_picker"></block>
            <block type="colour_random"></block>
            <block type="colour_rgb">
                <value name="RED">
                    <shadow type="math_number">
                        <field name="NUM">100</field>
                    </shadow>
                </value>
                <value name="GREEN">
                    <shadow type="math_number">
                        <field name="NUM">50</field>
                    </shadow>
                </value>
                <value name="BLUE">
                    <shadow type="math_number">
                        <field name="NUM">0</field>
                    </shadow>
                </value>
            </block>
            <block type="colour_blend">
                <value name="COLOUR1">
                    <shadow type="colour_picker">
                        <field name="COLOUR">#ff0000</field>
                    </shadow>
                </value>
                <value name="COLOUR2">
                    <shadow type="colour_picker">
                        <field name="COLOUR">#3333ff</field>
                    </shadow>
                </value>
                <value name="RATIO">
                    <shadow type="math_number">
                        <field name="NUM">0.5</field>
                    </shadow>
                </value>
            </block>
        </category> -->

        <sep></sep>
        <category id="catVariables" colour="330" custom="VARIABLE" name="Variables"></category>
        <category id="catFunctions" colour="290" custom="PROCEDURE" name="Functions"></category>
        <sep></sep>
        <category colour="330" name="Insect Farm Elements">
            <block type="Box">
            </block>
            <block type="Egg">
            </block>
            <block type="AGV">
            </block>
            <block type="Adult">
            </block>
            <block type="Compartment">
            </block>
        </category>
        <category colour="290" name="Insect Farm Functions">
            <block type="Grab">
            </block>
            <block type="Drop">
            </block>
            </block>
            <block type="Feed">
            </block>
            <block type="MoveTo">
            </block>
            <block type="MoveToItem">
            </block>
            <block type="Put">
            </block>
            <block type="Take">
            </block>
        </category>
        <category colour="290" name="Insect Farm Complex Functions">
            <block type="MoveItemTo">
            </block>
            <block type="MoveItemToItem">
            </block>
<!--            <block type="ChangePopulationOfBox">-->
<!--            </block>-->
            <block type="ChangeBoxOfItem">
            </block>
        </category>
    </xml>
    <script>
        var demoWorkspace = Blockly.inject('blocklyDiv',
            {renderer: 'zelos',
                language: 'python',
                toolbox: document.getElementById('toolbox')});
        demoWorkspace .addChangeListener(function(event) {
            workspaceToCodeDebug(demoWorkspace);
        });
    </script>

    <div id="debug" style="display: flex">
        <p id="debugText1", style="width: 400px; height: auto">ABC</p>
        <p id="debugText2", style="width: 400px; height: auto">DEF</p>
    </div>
</div>

<div id="skill_level_selection_back">
</div>
<div id="skill_level_selection">
    <p>How familiar are you with programming?</p>
    <div class="answer" onclick="setComplexityLevel(SKILL_LEVELS.BEGINNER, true)">
        I am a beginner
        <div class="tip">Only the basics.</div>
    </div>
    <div class="answer" onclick="setComplexityLevel(SKILL_LEVELS.INTERMEDIATE, true)">
        I am a little familiar
        <div class="tip">You will have access to math, text, and lists.</div>
    </div>
    <div class="answer" onclick="setComplexityLevel(SKILL_LEVELS.EXPERT, true)">
        I am an expert
        <div class="tip">You will have access to variables and functions.</div>
    </div>
</div>

<script>

const SKILL_LEVELS = {
    BEGINNER: 0,
    INTERMEDIATE: 1,
    EXPERT: 2
}
let skill_level = SKILL_LEVELS.BEGINNER;

/*
    access level 0:
    Purpose: Teach user step-by-step programming.
    - basic logic modules (if)
    - insect farm elements
    - insect farm functions

    access level 1:
    - text

    access level 2 (free mode):
    Purpose of free mode: General programming.
    Allows the user to build routines for the insect farm using custom functions
    - functions
*/

/*
    map:
    logic: blockly-0
    loops: blockly-1
    math: blockly-2
    text: blockly-3
    lists: blockly-4

    variables: blockly-5
    functions: blockly-6
*/

const categories = new Map();

class TabCategory {
    constructor(id) {
        this.id = id;
        this.DOM_element = document.getElementById(id);
        this.DOM_element_default_height = this.DOM_element.style.height;
        this.visible = true;
    }

    hide = function() {
        this.DOM_element.style.visibility = "hidden";
        this.DOM_element.style.height = "0px";
        this.visible = false;
    }

    show = function() {
        this.DOM_element.style.visibility = "visible";
        this.DOM_element.style.height = this.DOM_element_default_height;
        if (!this.visible) {
            this.DOM_element.style.animation = null;
            this.DOM_element.offsetHeight;
            this.DOM_element.style.animation = "fade_in .5s forwards"
        }
        this.visible = true;
    }
}

categories.set("logic",     new TabCategory("blockly-0"));
categories.set("loops",     new TabCategory("blockly-1"));
categories.set("math",      new TabCategory("blockly-2"));
categories.set("text",      new TabCategory("blockly-3"));
categories.set("lists",     new TabCategory("blockly-4"));
categories.set("variables", new TabCategory("blockly-6"));
categories.set("functions", new TabCategory("blockly-7"));
categories.set("farm_elements", new TabCategory("blockly-9"));
categories.set("farm_funcs", new TabCategory("blockly-a"));
categories.set("farm_complex_funcs", new TabCategory("blockly-b"));

categories.forEach((vals, keys) => {
    vals.hide();
});

function refreshCategories() {
    switch(skill_level) {
        case SKILL_LEVELS.BEGINNER:
                categories.get("logic")         .show();
                categories.get("loops")         .show();
                categories.get("math")          .hide();
                categories.get("text")          .hide();
                categories.get("lists")         .hide();
                categories.get("variables")     .hide();
                categories.get("functions")     .hide();
            break;

        case SKILL_LEVELS.INTERMEDIATE:
                categories.get("logic")         .show();
                categories.get("loops")         .show();
                categories.get("math")          .show();
                categories.get("text")          .show();
                categories.get("lists")         .hide();
                categories.get("variables")     .hide();
                categories.get("functions")     .hide();

            break;

        case SKILL_LEVELS.EXPERT:
                categories.get("logic")         .show();
                categories.get("loops")         .show();
                categories.get("math")          .show();
                categories.get("text")          .show();
                categories.get("lists")         .show();
                categories.get("variables")     .show();
                categories.get("functions")     .show();
            break;
    }

    categories.get("farm_elements") .show();
    categories.get("farm_funcs")    .show();
    categories.get("farm_complex_funcs").show();
}

function setComplexityLevel(level, intro_screen=false) {
    skill_level = level;
    refreshCategories();

    if (intro_screen) {
        removeIntroScreen();
    }
}

function removeIntroScreen() {
    var skill_level_back = document.getElementById("skill_level_selection_back");
    var skill_level = document.getElementById("skill_level_selection");

    document.body.removeChild(skill_level_back);
    document.body.removeChild(skill_level);
}

</script>

<button onclick="setComplexityLevel(SKILL_LEVELS.BEGINNER)">Beginner</button>
<button onclick="setComplexityLevel(SKILL_LEVELS.INTERMEDIATE)">Intermediate</button>
<button onclick="setComplexityLevel(SKILL_LEVELS.EXPERT)">Expert</button>

<button onclick="sendRequest()">Send Code</button>

<label for="token">Token: </label>
<textarea id="token" rows="1" cols="50" style="font-size: small"></textarea>

<div id="output">
    Output:
    <p id="outputText"></p>
</div>

</body>
</html>